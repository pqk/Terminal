_1_1

Option Explicit
Public rdate, matchdate, PW, filedir, destination_file

Sub AP_Master()
    Call AP_BU_Results
    Call AP_Results
    
    MsgBox "?f?[?^?I?????d?R?1?μ?U?μ???B"
    
End Sub


Sub AP_BU_Results()
Dim matchdate, sourcefile, source_sheet, dest_sheet
Dim results_rng As Range

Application.ScreenUpdating = False

'Assign Variables
rdate = Application.InputBox(prompt:="?n???I“u?t?d“u?I?μ?A‰o?3?￠?B (YYYYMM ?`?R)", Type:=1)
    If rdate = "" Then Exit Sub
matchdate = DateSerial(CInt(Left(rdate, 4)), CInt(Mid(rdate, 5, 2)), CInt(1))
PW = "aplus"    'PW changed from "gz" as of 201509 data
filedir = Application.InputBox(prompt:="?3?f?[?^?I?i”[?a?I?t?@?C???I?p?X?d‘S?A“u?I?μ?A‰o?3?￠?B")
'"C:\Users\400001946\Documents\GZ_MI\Aplus\AP_datafiles"

sourcefile = "‰i?D?E???×_" & rdate & ".xlsx"
destination_file = "Aplus_GZ_Data.xlsm"
source_sheet = "?E?†"
dest_sheet = "BU_Results"

'Refresh Pivot_Tables reference dates
With Worksheets("Analysis_Aplus")
    .Range("L1").Value = Int(Mid(rdate, 5, 2))
    .Range("L2").Value = Int(Mid(rdate, 1, 4))
End With

'Open source file
Workbooks.Open Password:=PW, Filename:=filedir & Application.PathSeparator & sourcefile
ActiveWindow.Zoom = 70

'Locate new data records, copy & paste
'Values 1
Worksheets(source_sheet).Rows("2:2").Find(what:=matchdate).Activate
ActiveCell.Offset(1, 0).Range("A1:A3").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate 'CHANGE
Set results_rng = Rows("2:2").Find(what:=rdate)
results_rng.Offset(1, 0).PasteSpecial Paste:=xlPasteValues

'Values 2
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(4, 0).Range("A1:A21").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate 'CHANGE
results_rng.Offset(7, 0).PasteSpecial Paste:=xlPasteValues

'Values 3
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(28, 0).Range("A1:A9").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate 'CHANGE
results_rng.Offset(30, 0).PasteSpecial Paste:=xlPasteValues

'Values 3.5
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(39, 0).Range("A1:A9").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate 'CHANGE
results_rng.Offset(40, 0).PasteSpecial Paste:=xlPasteValues

'Values 4
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(50, 0).Range("A1:A2").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate 'CHANGE
results_rng.Offset(61, 0).PasteSpecial Paste:=xlPasteValues

'Values 5
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(53, 0).Range("A1:A2").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate 'CHANGE
results_rng.Offset(63, 0).PasteSpecial Paste:=xlPasteValues

'Values 6
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(56, 0).Range("A1:A2").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate 'CHANGE
results_rng.Offset(65, 0).PasteSpecial Paste:=xlPasteValues

'Values 7
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(59, 0).Range("A1:A2").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate 'CHANGE
results_rng.Offset(67, 0).PasteSpecial Paste:=xlPasteValues

Workbooks(sourcefile).Close savechanges:=False

End Sub


Sub AP_Results()
Dim sourcefile, source_sheet, dest_sheet
Dim results_rng As Range

Application.ScreenUpdating = False

sourcefile = "Aplus_?O?O?|_?o’??c_" & rdate & ".xlsx"
source_sheet = "?U?A?s"
dest_sheet = "Results"

'Open source file
Workbooks.Open Password:=PW, Filename:=filedir & Application.PathSeparator & sourcefile
ActiveWindow.Zoom = 70

'Locate new data records, copy & paste
'Values 1
Worksheets(source_sheet).Rows("5:5").Find(what:=rdate).Activate
ActiveCell.Offset(1, 0).Range("A1:A5").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate
Set results_rng = Rows("5:5").Find(what:=rdate)
results_rng.Offset(1, 0).PasteSpecial Paste:=xlPasteValues
results_rng.Offset(1, 0).Range("A1:A5").Interior.Color = RGB(219, 229, 241)

'Values 2
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(8, 0).Range("A1:A5").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate
results_rng.Offset(8, 0).PasteSpecial Paste:=xlPasteValues
results_rng.Offset(8, 0).Range("A1:A5").Interior.Color = RGB(219, 229, 241)

'Values 3
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(22, 0).Range("A1:A5").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate
results_rng.Offset(22, 0).PasteSpecial Paste:=xlPasteValues
results_rng.Offset(22, 0).Range("A1:A5").Interior.Color = RGB(219, 229, 241)

'Values 4
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(29, 0).Range("A1:A5").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate
results_rng.Offset(29, 0).PasteSpecial Paste:=xlPasteValues
results_rng.Offset(29, 0).Range("A1:A5").Interior.Color = RGB(219, 229, 241)

'Values 5
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(43, 0).Range("A1:A5").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate
results_rng.Offset(43, 0).PasteSpecial Paste:=xlPasteValues
results_rng.Offset(43, 0).Range("A1:A5").Interior.Color = RGB(219, 229, 241)

'Values 6
Workbooks(sourcefile).Worksheets(source_sheet).Activate
ActiveCell.Offset(50, 0).Range("A1:A5").Copy

Workbooks(destination_file).Sheets(dest_sheet).Activate
results_rng.Offset(50, 0).PasteSpecial Paste:=xlPasteValues
results_rng.Offset(50, 0).Range("A1:A5").Interior.Color = RGB(219, 229, 241)

Workbooks(sourcefile).Close savechanges:=False

End Sub


_1_2







