Option Explicit
Public rdate, matchdate, tabdate, pwdate, filedir

Sub SK_Master()
    Call SK_Results
    Call SK_Reserve
    
    MsgBox "?f?[?^?I?????d?R?1?μ?U?μ???B"
    
End Sub

Sub SK_Results()
Dim sourcefile
Dim results_rng As Range
Dim headingdate2, headingdate1

Application.ScreenUpdating = False

'Assign Variables
rdate = Application.InputBox(prompt:="?n???I“u?t?d“u?I?μ?A‰o?3?￠?B (YYYYMM ?`?R)", Type:=1)
    If rdate = "" Then Exit Sub
matchdate = DateSerial(CInt(Left(rdate, 4)), CInt(Mid(rdate, 5, 2)), CInt(1))

If CInt(Mid(rdate, 5, 2)) = 1 Or CInt(Mid(rdate, 5, 2)) = 2 Or CInt(Mid(rdate, 5, 2)) = 3 Then
    tabdate = CInt(Left(rdate, 4)) - 1
Else: tabdate = CInt(Left(rdate, 4))
End If

pwdate = CInt(Mid(rdate, 3, 4))
filedir = Application.InputBox(prompt:="?3?f?[?^?I?i”[?a?I?t?@?C???I?p?X?d‘S?A“u?I?μ?A‰o?3?￠?B")
'"C:\Users\400001946\Documents\GZ_MI\Shinki\SK_datafiles"
headingdate2 = Format(WorksheetFunction.EoMonth(matchdate, 0), "m/dd/yyyy")
headingdate1 = CInt(Mid(rdate, 5, 2)) & "??"

'Refresh Pivot_Tables reference dates
With Worksheets("analysis1")
    .Range("L1").Value = Int(Mid(rdate, 5, 2))
    .Range("L2").Value = Int(Mid(rdate, 1, 4))
End With

        
'Open source file
sourcefile = "??‘§?O?O’P‰????U?\_" & rdate & ".xlsx"

Workbooks.Open Password:=pwdate, filename:=filedir & "\" & sourcefile
ActiveWindow.Zoom = 70

'<<<< LOCATE NEW DATA RECORDS >>>>
Sheets("FY" & tabdate).Range("A1").Offset(0, 4).End(xlDown).Activate
ActiveCell.Offset(1, 0).Rows("1:1").EntireRow.Find(what:=matchdate).Activate

'Copy & Paste
'Value 1
ActiveCell.Offset(1, 0).Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Results").Activate
Set results_rng = Rows("2:2").Find(what:=matchdate)
results_rng.Offset(1, 0).PasteSpecial Paste:=xlPasteValues

'Value 2
Workbooks(sourcefile).Sheets("FY" & tabdate).Activate
ActiveCell.Offset(3, 0).Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Results").Activate
results_rng.Offset(3, 0).PasteSpecial Paste:=xlPasteValues

'Value 3
Workbooks(sourcefile).Sheets("FY" & tabdate).Activate
ActiveCell.Offset(5, 0).Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Results").Activate
results_rng.Offset(5, 0).PasteSpecial Paste:=xlPasteValues

'Value 4
Workbooks(sourcefile).Sheets("FY" & tabdate).Activate
ActiveCell.Offset(7, 0).Range("a1:A2").Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Results").Activate
results_rng.Offset(7, 0).PasteSpecial Paste:=xlPasteValues

'Value 5
Workbooks(sourcefile).Sheets("FY" & tabdate).Activate
ActiveCell.Offset(12, 0).Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Results").Activate
results_rng.Offset(12, 0).PasteSpecial Paste:=xlPasteValues

'Value 6
Workbooks(sourcefile).Sheets("FY" & tabdate).Activate
ActiveCell.Offset(14, 0).Range("a1:A3").Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Results").Activate
results_rng.Offset(14, 0).PasteSpecial Paste:=xlPasteValues

'Value 7
Workbooks(sourcefile).Sheets("FY" & tabdate).Activate
ActiveCell.Offset(22, 0).Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Results").Activate
results_rng.Offset(22, 0).PasteSpecial Paste:=xlPasteValues

'Value 8
Workbooks(sourcefile).Sheets("FY" & tabdate).Activate
ActiveCell.Offset(24, 0).Range("a1:A3").Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Results").Activate
results_rng.Offset(24, 0).PasteSpecial Paste:=xlPasteValues

'Value 9
Workbooks(sourcefile).Sheets("FY" & tabdate).Activate
ActiveCell.Offset(41, 0).Range("a1:A2").Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Results").Activate
results_rng.Offset(41, 0).PasteSpecial Paste:=xlPasteValues

'Value 10
Workbooks(sourcefile).Sheets("FY" & tabdate).Activate
ActiveCell.Offset(55, 0).Range("a1:A3").Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Results").Activate
results_rng.Offset(55, 0).PasteSpecial Paste:=xlPasteValues

Workbooks(sourcefile).Close savechanges:=False

End Sub


Sub SK_Reserve()
Dim sourcefile
Dim res_rng As Range

Application.ScreenUpdating = False
   
'Open source file
sourcefile = "??‘§?O?O???U?\_" & rdate & ".xlsx"

Workbooks.Open Password:=pwdate, filename:=filedir & "\" & sourcefile

'Locate new data record
Set res_rng = Columns("B:B").Find(what:="?o“??a", SearchOrder:=xlByRows).Offset(1, 1).Range("A1:L1")
res_rng.Copy
res_rng.PasteSpecial Paste:=xlPasteValues
Selection.Find(what:=matchdate).Activate

'Copy & Past Reserve EOP Balance
ActiveCell.Offset(2, 0).Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Reserve").Activate
Columns("A:A").Find(what:=matchdate).Offset(0, 4).Range("A1").Select
ActiveCell.PasteSpecial Paste:=xlPasteValues

'Copy & Past Actuals
Workbooks(sourcefile).Sheets("FY" & tabdate).Activate
ActiveCell.Offset(7, 0).Range("A1:A2").Copy

Workbooks("Shinki_GZ_data.xlsm").Sheets("Reserve").Activate
Columns("A:A").Find(what:=matchdate).Offset(0, 1).Range("A1").Select
ActiveCell.PasteSpecial Paste:=xlPasteValues, Transpose:=True

Workbooks(sourcefile).Close savechanges:=False

End Sub




